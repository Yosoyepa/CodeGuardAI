name: Lint & Format Check

on:
  push:
    branches: [main, develop, "feature/**"]
    paths:
      - "backend/**/*.py"
      - ".github/workflows/lint.yml"
  pull_request:
    branches: [main, develop]
    paths:
      - "backend/**/*.py"

jobs:
  lint:
    name: Code Quality Check
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"
      
      - name: Install linting dependencies
        run: |
          python -m pip install --upgrade pip
          pip install black>=23.0.0 flake8>=7.0.0 isort>=5.13.0
      
      - name: Check code formatting with Black
        run: |
          cd backend
          black src/ --line-length=100 --check
      
      - name: Check import sorting with isort
        run: |
          cd backend
          isort src/ --profile=black --line-length=100 --check-only
      
      - name: Lint with Flake8
        run: |
          cd backend
          flake8 src/ --count --select=E9,F63,F7,F82 --show-source --statistics
          flake8 src/ --count --max-complexity=10 --max-line-length=100 --statistics
      
      - name: Summary
        if: success()
        run: |
          echo "= All code quality checks passed!"
          echo "- Black formatting: ✓"
          echo "- Import sorting (isort): ✓"
          echo "- Linting (flake8): ✓"
